<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.surpass.persistence.mapper.HistoryOpenapiMapper">
    <select id="pageList" parameterType="com.surpass.entity.history.dto.HistoryOpenapiPageDto"
            resultType="com.surpass.entity.history.HistoryOpenapi">
        SELECT
        h.*
        FROM
        surpass_history_openapi h
        WHERE
        1 = 1

        <!-- 请求ID -->
        <if test="requestId != null and requestId != ''">
            AND h.request_id LIKE CONCAT('%', #{requestId}, '%')
        </if>

        <!-- Client ID -->
        <if test="clientId != null and clientId != ''">
            AND h.client_id LIKE CONCAT('%', #{clientId}, '%')
        </if>

        <!-- 应用名称 -->
        <if test="appName != null and appName != ''">
            AND h.app_name LIKE CONCAT('%', #{appName}, '%')
        </if>

        <!-- 资源名称 -->
        <if test="resourceName != null and resourceName != ''">
            AND h.resource_name LIKE CONCAT('%', #{resourceName}, '%')
        </if>

        <!-- 请求方法 -->
        <if test="requestMethod != null and requestMethod != ''">
            AND h.request_method = #{requestMethod}
        </if>

        <!-- 开始时间 -->
        <if test="startTime != null">
            AND h.access_time <![CDATA[ >= ]]> #{startTime}
        </if>

        <!-- 结束时间 -->
        <if test="endTime != null">
            AND h.access_time <![CDATA[ <= ]]> #{endTime}
        </if>

        ORDER BY
        h.access_time DESC
    </select>
</mapper>
